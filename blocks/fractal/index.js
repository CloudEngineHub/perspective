import n from"https://cdn.jsdelivr.net/npm/@finos/perspective@3.1.1/dist/cdn/perspective.js";function e(n){return`\n// color\nvar resolution := ${n.resolution};\nvar xmin := ${n.xmin};\nvar xmax := ${n.xmax};\nvar ymin := ${n.ymin};\nvar ymax := ${n.ymax};\nvar iterations := ${n.iterations};\n\nvar x := floor("index" / resolution);\nvar y := "index" % resolution;\nvar c := iterations;\n\nvar cx := xmin + ((xmax - xmin) * x) / (resolution - 1);\nvar cy := ymin + ((ymax - ymin) * y) / (resolution - 1);\n\nvar vx := 0;\nvar vy := 0;\nvar vxx := 0;\nvar vyy := 0;\nvar vxy := 0;\n\nfor (var ii := 0; ii < iterations; ii += 1) {\n    if (vxx + vyy <= float(4)) {\n        vxy := vx * vy;\n        vxx := vx * vx;\n        vyy := vy * vy;\n        vx := vxx - vyy + cx;\n        vy := vxy + vxy + cy;\n        c -= 1;\n    }\n};\n\nc`}function i(n,e,i){n.addEventListener("input",(()=>{window.run.disabled=!1,n.value=Math.min(n.valueAsNumber,e.valueAsNumber-.1)})),e.addEventListener("input",(()=>{window.run.disabled=!1,e.value=Math.max(n.valueAsNumber+.1,e.valueAsNumber)}))}const r=(n,i)=>async()=>{if("Run"!==window.run.innerHTML.trim())return void(window.run.innerHTML="Run");window.run.disabled=!0,i.table||(i.table=await n.table({index:"integer"}),window.viewer.load(Promise.resolve(i.table)));const r=document.getElementById("run"),t=["xmin","xmax","ymin","ymax","resolution","iterations"].reduce(((n,e)=>(n[e]=window[e].valueAsNumber,n)),{}),o=Math.pow(t.resolution,2);if(!i.size||i.size!==o){let n={index:new Array(o)};for(let e=0;e<o;++e)n.index[e]=e;i.table.replace(n)}i.size=o,r.innerHTML="Run",window.viewer.restore(function(n){return{plugin:"Heatmap",settings:!0,group_by:[`floor("index" / ${n.resolution})`],split_by:[`"index" % ${n.resolution}`],columns:["color"],expressions:{color:e(n).trim(),[`floor("index" / ${n.resolution})`]:`floor("index" / ${n.resolution})`,[`"index" % ${n.resolution}`]:`"index" % ${n.resolution}`}}}(t))};function t(){window.run.disabled=!1}window.addEventListener("DOMContentLoaded",(async function(){await customElements.whenDefined("perspective-viewer");(await window.viewer.getPlugin("Heatmap")).max_cells=1e5,i(xmin,xmax),i(ymin,ymax),window.resolution.addEventListener("input",t),window.iterations.addEventListener("input",t),run.addEventListener("click",r(await n.worker(),{})),run.dispatchEvent(new Event("click"))}));